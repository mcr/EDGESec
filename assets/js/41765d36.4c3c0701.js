"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[615],{3905:function(e,t,r){r.d(t,{Zo:function(){return u},kt:function(){return m}});var n=r(7294);function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function o(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function s(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},l=Object.keys(e);for(n=0;n<l.length;n++)r=l[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)r=l[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var i=n.createContext({}),p=function(e){var t=n.useContext(i),r=t;return e&&(r="function"==typeof e?e(t):o(o({},t),e)),r},u=function(e){var t=p(e.components);return n.createElement(i.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},c=n.forwardRef((function(e,t){var r=e.components,a=e.mdxType,l=e.originalType,i=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),c=p(r),m=a,k=c["".concat(i,".").concat(m)]||c[m]||d[m]||l;return r?n.createElement(k,o(o({ref:t},u),{},{components:r})):n.createElement(k,o({ref:t},u))}));function m(e,t){var r=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var l=r.length,o=new Array(l);o[0]=c;var s={};for(var i in t)hasOwnProperty.call(t,i)&&(s[i]=t[i]);s.originalType=e,s.mdxType="string"==typeof e?e:a,o[1]=s;for(var p=2;p<l;p++)o[p]=r[p];return n.createElement.apply(null,o)}return n.createElement.apply(null,r)}c.displayName="MDXCreateElement"},2601:function(e,t,r){r.r(t),r.d(t,{frontMatter:function(){return s},contentTitle:function(){return i},metadata:function(){return p},toc:function(){return u},default:function(){return c}});var n=r(7462),a=r(3366),l=(r(7294),r(3905)),o=["components"],s={slug:"storage",title:"Secure Storage"},i=void 0,p={unversionedId:"storage",id:"storage",isDocsHomePage:!1,title:"Secure Storage",description:"The secure storage service implements a key/value store for all other services to store and retrieve encrypted keys or data. To encrypt data the secure storage generates keys that are encrypted using the hardware secure element or a user supplied passphrase.",source:"@site/docs/storage.md",sourceDirName:".",slug:"/storage",permalink:"/EDGESec/docs/storage",editUrl:"https://github.com/nqminds/docusaurus-template/edit/master/docs/storage.md",tags:[],version:"current",frontMatter:{slug:"storage",title:"Secure Storage"},sidebar:"someSidebar",previous:{title:"Device Discovery",permalink:"/EDGESec/docs/discovery"},next:{title:"Installation",permalink:"/EDGESec/docs/installation"}},u=[],d={toc:u};function c(e){var t=e.components,r=(0,a.Z)(e,o);return(0,l.kt)("wrapper",(0,n.Z)({},d,r,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("p",null,"The secure storage service implements a key/value store for all other services to store and retrieve encrypted keys or data. To encrypt data the secure storage generates keys that are encrypted using the hardware secure element or a user supplied passphrase."),(0,l.kt)("p",null,"The secure storage is implemented as a sqlite database with two tables secrets and store."),(0,l.kt)("p",null,"The schema for the secrets table is as follows:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"CREATE TABLE secrets (id TEXT NOT NULL, value TEXT, salt TEXT, iv TEXT, PRIMARY KEY (id));\n")),(0,l.kt)("p",null,"where ",(0,l.kt)("strong",{parentName:"p"},"id")," is the ID of the generated key, ",(0,l.kt)("strong",{parentName:"p"},"value")," is the value of the key, ",(0,l.kt)("strong",{parentName:"p"},"iv")," the the IV used to encrypt and decrypt the key and ",(0,l.kt)("strong",{parentName:"p"},"salt")," is the salt sed ofr encryption and decryption when a userpasspharse is supplied."),(0,l.kt)("p",null,"An example of the secrets table row is given below:"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"ID"),(0,l.kt)("th",{parentName:"tr",align:null},"VALUE"),(0,l.kt)("th",{parentName:"tr",align:null},"SALT"),(0,l.kt)("th",{parentName:"tr",align:null},"IV"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"master"),(0,l.kt)("td",{parentName:"tr",align:null},"LbknNO6o+s+u1b4wg9eGzQjHCanicVtDlDJBWZ0u4VaV25oIUCt1b5bthzLwhQO0"),(0,l.kt)("td",{parentName:"tr",align:null},"Z95m5G/+jgb3ga0dufa//w"),(0,l.kt)("td",{parentName:"tr",align:null},"hka2MmSUkJUJBf7TQMYnug")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"rest"),(0,l.kt)("td",{parentName:"tr",align:null},"a2UiZR/DLYb3hX61ZQ7Mb/vdVVIchJzkuNnoIhLDCHXe9453IlWjOfOymodUZIsq"),(0,l.kt)("td",{parentName:"tr",align:null},"RLdlnafYj7279lne7A5UoA"),(0,l.kt)("td",{parentName:"tr",align:null},"lgTKNxgxbeCxg4VySS/7vw")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"94:b9:7e:15:47:95"),(0,l.kt)("td",{parentName:"tr",align:null},"lPVf5wqMnb9+8Q8Cik5oetOI9MfA6qjPm1tKTR3WGPWgZYtaybEeDKWGX/x4EUUB"),(0,l.kt)("td",{parentName:"tr",align:null},"gFvI5tfeHANOafJlFsHXpg"),(0,l.kt)("td",{parentName:"tr",align:null},"mH2yeX/FEvJd1ilg25Zwcg")))),(0,l.kt)("p",null,"The ",(0,l.kt)("strong",{parentName:"p"},"value"),", ",(0,l.kt)("strong",{parentName:"p"},"salt")," and ",(0,l.kt)("strong",{parentName:"p"},"iv")," are base64 encoded."),(0,l.kt)("p",null,"When a user or service wants to store a key/value she will need to provide and ID for the key that will be used to encrypt/decrypt the user's value. If such an ID does not exists in the secrets table, the service will randomly generate one and encrypt it using the hardware secure element or the user supplied passphrase. When the user provides the passphrase the service will generate an encryption key using the \\b salt and Password-Based Key Derivation Function Password-Based Key Derivation Function 2. The derived key is not stored on the device. If the user instead uses the hardware secure element, the key derivation, encryption and decryption is done in secure memory."),(0,l.kt)("p",null,"Each key/value is stored in the store table with the following schema:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"CREATE TABLE store (key TEXT NOT NULL, value TEXT, id TEXT, iv TEXT, PRIMARY KEY (key));\n")),(0,l.kt)("p",null,"where ",(0,l.kt)("strong",{parentName:"p"},"key")," is the key for the value, ",(0,l.kt)("strong",{parentName:"p"},"value")," is the value to be stored, ",(0,l.kt)("strong",{parentName:"p"},"id")," is the key id used to encrypt/decrypt the value and ",(0,l.kt)("strong",{parentName:"p"},"iv")," is the IV used to encrypt/decrypt the value."),(0,l.kt)("p",null,"An example of the store table rows is given below."),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"KEY"),(0,l.kt)("th",{parentName:"tr",align:null},"VALUE"),(0,l.kt)("th",{parentName:"tr",align:null},"ID"),(0,l.kt)("th",{parentName:"tr",align:null},"IV"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"7815f8ce-57b8-49c8-9121-5b98986cbccd"),(0,l.kt)("td",{parentName:"tr",align:null},"GCM564Ugwyh0bW3f4JuFkw"),(0,l.kt)("td",{parentName:"tr",align:null},"master"),(0,l.kt)("td",{parentName:"tr",align:null},"Ja0pz9cdH7p3Q+BBP2MIrw")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"db07c38a-2842-4f45-9672-74d57ec99e63"),(0,l.kt)("td",{parentName:"tr",align:null},"23cHWe6r033czxopWsv6Ng"),(0,l.kt)("td",{parentName:"tr",align:null},"master"),(0,l.kt)("td",{parentName:"tr",align:null},"FU7hUGGbifro65cv0u0OwQ")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"1a35f54d-c5f9-4072-85b0-4b40f8fb4a14"),(0,l.kt)("td",{parentName:"tr",align:null},"LR3iRw6SrN/pWKSTJvNtrA"),(0,l.kt)("td",{parentName:"tr",align:null},"master"),(0,l.kt)("td",{parentName:"tr",align:null},"x9hFentG2Q6iynHXCk2ktA")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"831ffbb1-2e79-422a-bdad-e9e96a56d568"),(0,l.kt)("td",{parentName:"tr",align:null},"CdoxKK4PbDvWD9cOdRcTXQ"),(0,l.kt)("td",{parentName:"tr",align:null},"master"),(0,l.kt)("td",{parentName:"tr",align:null},"RHR1AGsjpWVHDR4VN2PiLA")))),(0,l.kt)("p",null,"The ",(0,l.kt)("strong",{parentName:"p"},"value")," and ",(0,l.kt)("strong",{parentName:"p"},"iv")," is base64 encoded."),(0,l.kt)("p",null,"Each row of the key/value store contains the ",(0,l.kt)("strong",{parentName:"p"},"id")," of the key that was used to encrypt/decrypt the ",(0,l.kt)("strong",{parentName:"p"},"value"),". The encryption algorithm used is AES 256 CBC."))}c.isMDXComponent=!0}}]);